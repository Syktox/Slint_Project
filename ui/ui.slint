import { Button } from "std-widgets.slint";

import { homeView } from "home.slint";
import { settingsView } from "settings.slint";
import { gameView } from "game.slint";

import { ViewState, slint_GameSettings } from "types.slint";

export component AppWindow inherits Window {
    // Setup
    title: "Hangman";

    preferred-width: 100%;
    preferred-height: 100%;

    min-width: 800px;
    min-height: 600px;

    // Views
    in property<ViewState> current_view;

    // Callbacks for homeView
    callback start_clicked();
    callback settings_clicked();
    callback quit_clicked();

    if (current_view == ViewState.Home ) : homeView { 
        start_clicked => root.start_clicked();
        settings_clicked() => root.settings_clicked();
        quit_clicked => root.quit_clicked();
    }
   
    // Callbacks for gameView
    callback letter_pressed(string);
    callback reset_game();
    callback home_clicked();

    // forward-focus: 
    forward-focus: key-handler;
    
    key-handler := FocusScope {
        key-pressed(event) => {
            root.letter_pressed(event.text.to-uppercase());
            accept
        }
    }

    init => { key-handler.focus(); }

    in property <string> display_word;
    in property <string> status_msg;
    in property <int> mistakes;
    in property <bool> game_won;
    in property <bool> game_over;

    if (current_view == ViewState.Game ): gameView { 
        letter_pressed(l) => root.letter_pressed(l);
        reset_game() => root.reset_game();
        home_clicked() => root.home_clicked();

        display_word <=> root.display_word;
        status_msg <=> root.status_msg;
        mistakes <=> root.mistakes;
        game_won <=> root.game_won;
        game_over <=> root.game_over;
    }

    // Callbacks for settingsView
    callback save_clicked();
    callback cancel_clicked();

    in-out property <slint_GameSettings> settings;
   
    if (current_view == ViewState.Settings ) : settingsView {
        save_clicked => root.save_clicked();
        cancel_clicked => root.cancel_clicked();
        
        settings <=> root.settings;
    }
}